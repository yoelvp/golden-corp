---
import { Image } from "astro:assets"
import logo from "../../assets/logo-white.svg"
import { pages } from "../../constants/pages"
import HamburguerMenu from './HamburgerMenu.astro'
import type { Page } from "@/types/pages"

const { pathname } = Astro.url
const normalizedPathName =
  pathname.length > 1 && pathname.endsWith("/") ? pathname.slice(0, -1) : pathname

const currentPages: Page[] = pages.map((page) => ({
  ...page,
  isActive: normalizedPathName === page.href,
}))
---

<header class="fixed top-0 left-0 z-[100] w-full h-20 bg-primary border-b border-slate-700 flex items-center">
  <div class="section-layout flex justify-between items-center">
    <a href="/">
      <Image src={logo} alt="logo" class="h-12 w-auto" />
    </a>

    <HamburguerMenu id="menuButton" />

    <nav class="hidden items-center justify-center md:flex">
      <ul class="flex justify-center items-center menu">
        {currentPages.map((page) => (
          <li class="list-item">
            <a
              href={page.href}
              rel="noopener noreferrer"
              class="text-sm px-4 uppercase text-white menu-item"
              class:list={[{ "active-link": page.isActive }]}
            >
              {page.name}
          </a>
          <ul class="submenu-wrapper bg-primary/80">
            {page.subOptions && page.subOptions.map(subPage => (
              <li>
              <a href={subPage.href} class="w-full inline-block px-4 py-1 text-white hover:bg-secondary">
                  {subPage.name}
                </a>
              </li>
            ))}
          </ul>
          </li>
        ))}
      </ul>
    </nav>

    <nav id="navMobile" class="open-menu hidden">
      <div class="h-16 flex justify-end items-center">
        <button>
        </button>
      </div>
      {currentPages.map((page) => (
        <a
          href={page.href}
          rel="noopener noreferrer"
          class="px-4 uppercase text-white transition-colors"
          class:list={[{ "active-link": page.isActive }]}
        >
          {page.name}
        </a>
      ))}
    </nav>
  </div>
</header>

<style>
.open-menu {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: #000;
  z-index: 100;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

.menu-item {
  position: relative;
}

.menu-item::after {
  position: absolute;
  content: '';
  bottom: -4px;
  left: 0;
  width: 100%;
  height: 2px;
  background-color: var(--secondary);
  transform: scale(0, 1);
  transition: transform 500ms cubic-bezier(0.57, 0.4, 0.55, 1.17);
}

.menu-item:hover {
  color: var(--secondary);
  transition: color 200ms ease;
}

.menu-item:hover::after {
  transform: scale(1, 1);
  color: var(--secondary);
}

.active-link {
  color: var(--secondary);
}

.active-link::after {
  position: absolute;
  content: '';
  left: 0;
  bottom: -4px;
  width: 100%;
  height: 2px;
  transform: scale(1, 1);
  background-color: var(--secondary);
}

.submenu-wrapper {
  display: none;
  position: absolute;
  width: 380px;
}

.menu li:hover .submenu-wrapper {
  display: block;
}
</style>

<script>
import { $ } from "@/lib/dom-selector";

const menuButton = $("#menu")
const navMobile = $("#navMobile")

menuButton?.addEventListener('click', () => {
  navMobile?.classList.toggle("hidden")
  navMobile?.classList.toggle("flex")
})
</script>
